window.addEventListener("load", addListener);
var count = 0, grade = 0, average = 0, grades = "0", count2 = 0, allGrades = "", trueFalse = false;

function addListener() {
    document.getElementById("btnsubmit").addEventListener("click", submit);
}

function submit() {
    if (count === 0) {
        count = parseInt(document.getElementById("txtenter").value);
        checkCount();
    } else {
        addGrades();
    }
}

function checkCount() {
    if (isNaN(count) || count <= 1) {
        alert("Invalid, please enter a number above 1");
        count = 0;  // 重置count，避免错误输入后跳过输入人数的阶段
    } else {
        document.getElementById("lblenter").textContent = "Enter the grade (0-100):";
        document.getElementById("txtenter").value = "";
        document.getElementById("txtenter").focus();
    }
}

function addGrades() {
    grade = parseInt(document.getElementById("txtenter").value);
    checkGrade();

    if (trueFalse) {
        grades += "," + grade;
        count2++;

        if (count2 === count) {
            calculateResults();
        } else {
            document.getElementById("txtenter").value = "";
            document.getElementById("txtenter").focus();
        }
    } else {
        alert("Invalid, please enter a number between 0 and 100");
        document.getElementById("txtenter").value = "";
        document.getElementById("txtenter").focus();
    }
}

function checkGrade() {
    trueFalse = grade >= 0 && grade <= 100 && !isNaN(grade);
}

function calculateResults() {
    let gradeArray = grades.split(",");
    average = 0;
    allGrades = "";

    for (let i = 1; i <= count; i++) {
        average += parseFloat(gradeArray[i]);
        allGrades += " Grade " + i + ": " + gradeArray[i];
    }

    average = Math.round((average / count) * 100) / 100;
    let gpa = Math.round((average / 100 * 4) * 100) / 100;

    document.getElementById("lbldisplay").innerHTML = allGrades + "<br>Average: " + average + "<br>GPA: " + gpa;

    // 重置所有变量
    reset();
}

function reset() {
    count = 0;
    grade = 0;
    average = 0;
    grades = "0";
    count2 = 0;
    allGrades = "";
    trueFalse = false;
    document.getElementById("lblenter").textContent = "Enter the number of grades:";
}
